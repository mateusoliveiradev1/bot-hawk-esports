# ü¶Ö Hawk Bot Esports - Guia de Administra√ß√£o

## üìã √çndice

1. [Vis√£o Geral](#vis√£o-geral)
2. [Instala√ß√£o e Deploy](#instala√ß√£o-e-deploy)
3. [Configura√ß√£o](#configura√ß√£o)
4. [Monitoramento](#monitoramento)
5. [Backup e Restaura√ß√£o](#backup-e-restaura√ß√£o)
6. [SSL/TLS](#ssltls)
7. [Manuten√ß√£o](#manuten√ß√£o)
8. [Troubleshooting](#troubleshooting)
9. [Comandos √öteis](#comandos-√∫teis)
10. [Logs](#logs)

---

## üéØ Vis√£o Geral

O Hawk Bot Esports √© um bot Discord profissional para comunidades de esports, executado em containers Docker com monitoramento completo, backup automatizado e SSL/TLS.

### Arquitetura do Sistema

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Discord API   ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   Hawk Bot      ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ     Redis       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚îÇ
                                ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Prometheus    ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ     Nginx       ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ    Grafana      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Componentes Principais

- **Hawk Bot**: Aplica√ß√£o principal do bot Discord
- **Redis**: Cache e armazenamento de sess√£o
- **Nginx**: Reverse proxy e SSL termination
- **Prometheus**: Coleta de m√©tricas
- **Grafana**: Visualiza√ß√£o de m√©tricas
- **Node Exporter**: M√©tricas do sistema
- **Watchtower**: Atualiza√ß√µes autom√°ticas

---

## üöÄ Instala√ß√£o e Deploy

### Pr√©-requisitos

- **Sistema Operacional**: Linux (Ubuntu 20.04+ recomendado)
- **Docker**: 20.10+
- **Docker Compose**: 1.29+
- **Mem√≥ria RAM**: M√≠nimo 2GB, recomendado 4GB+
- **Armazenamento**: M√≠nimo 10GB livres
- **Rede**: Portas 80, 443, 3000, 9090 dispon√≠veis

### Instala√ß√£o R√°pida

```bash
# 1. Clonar reposit√≥rio
git clone https://github.com/seu-usuario/bot-hawk-esports.git
cd bot-hawk-esports

# 2. Configurar vari√°veis de ambiente
cp .env.example .env
nano .env

# 3. Executar deploy
sudo bash scripts/deploy.sh
```

### Deploy Manual

```bash
# 1. Construir imagens
docker-compose -f docker-compose.prod.yml build

# 2. Iniciar servi√ßos
docker-compose -f docker-compose.prod.yml up -d

# 3. Verificar status
docker-compose -f docker-compose.prod.yml ps
```

---

## ‚öôÔ∏è Configura√ß√£o

### Vari√°veis de Ambiente (.env)

```bash
# Discord Bot
DISCORD_TOKEN=seu_token_aqui
DISCORD_CLIENT_ID=seu_client_id
DISCORD_GUILD_ID=seu_guild_id

# Redis
REDIS_URL=redis://hawk-redis:6379
REDIS_PASSWORD=senha_segura_redis

# Monitoramento
GRAFANA_ADMIN_PASSWORD=senha_admin_grafana
PROMETHEUS_RETENTION=30d

# Notifica√ß√µes
DISCORD_WEBHOOK_URL=https://discord.com/api/webhooks/...
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=seu_email@gmail.com
SMTP_PASS=sua_senha_app

# SSL/TLS
DOMAIN=bot.seudominio.com
EMAIL=admin@seudominio.com

# Backup
BACKUP_RETENTION_DAYS=30
BACKUP_SCHEDULE="0 2 * * *"
```

### Configura√ß√£o do Bot Discord

1. **Criar Aplica√ß√£o**: https://discord.com/developers/applications
2. **Criar Bot**: Na se√ß√£o "Bot", clique em "Add Bot"
3. **Copiar Token**: Salve o token na vari√°vel `DISCORD_TOKEN`
4. **Configurar Permiss√µes**:
   - Send Messages
   - Embed Links
   - Read Message History
   - Use Slash Commands
   - Manage Messages

### Configura√ß√£o de Dom√≠nio

```bash
# Configurar DNS (Tipo A)
bot.seudominio.com -> SEU_IP_SERVIDOR

# Configurar SSL
sudo bash scripts/setup-ssl.sh -d bot.seudominio.com -e admin@seudominio.com
```

---

## üìä Monitoramento

### Acessos

- **Grafana**: https://bot.seudominio.com:3000
  - Usu√°rio: `admin`
  - Senha: Definida em `GRAFANA_ADMIN_PASSWORD`

- **Prometheus**: https://bot.seudominio.com:9090

### Dashboards Principais

#### 1. Bot Status Dashboard
- Status de conex√£o do bot
- Comandos executados por minuto
- Lat√™ncia de resposta
- Uso de mem√≥ria e CPU

#### 2. System Metrics Dashboard
- CPU, mem√≥ria e disco do servidor
- Rede e I/O
- Containers rodando

#### 3. Redis Dashboard
- Conex√µes ativas
- Uso de mem√≥ria
- Opera√ß√µes por segundo
- Hit rate do cache

### Alertas Configurados

| Alerta | Condi√ß√£o | A√ß√£o |
|--------|----------|------|
| Bot Offline | Bot desconectado > 5min | Discord + Email |
| High CPU | CPU > 80% por 10min | Discord |
| High Memory | RAM > 90% por 5min | Discord + Email |
| Disk Full | Disco > 85% | Discord + Email |
| Redis Down | Redis offline > 2min | Discord + Email |
| SSL Expiry | Certificado expira em 7 dias | Email |

---

## üíæ Backup e Restaura√ß√£o

### Backup Autom√°tico

O sistema executa backups autom√°ticos diariamente √†s 2:00 AM.

```bash
# Verificar status do backup
crontab -l | grep backup

# Executar backup manual
sudo bash scripts/backup.sh

# Listar backups
ls -la /backups/
```

### Conte√∫do do Backup

- Dados da aplica√ß√£o (`/app/data`)
- Logs do sistema (`/app/logs`)
- Configura√ß√µes (`.env`)
- Dados do Redis (`dump.rdb`)
- M√©tricas do Prometheus
- Configura√ß√µes do Grafana
- Metadados do backup

### Restaura√ß√£o

```bash
# 1. Parar servi√ßos
docker-compose -f docker-compose.prod.yml down

# 2. Extrair backup
cd /backups
tar -xzf hawk-bot-backup_YYYYMMDD_HHMMSS.tar.gz

# 3. Restaurar dados
cp -r hawk-bot-backup_*/data/* /app/data/
cp hawk-bot-backup_*/.env.backup .env

# 4. Restaurar Redis
docker run --rm -v redis_data:/data -v /backups/hawk-bot-backup_*/redis-dump.rdb:/backup.rdb redis:alpine sh -c "cp /backup.rdb /data/dump.rdb"

# 5. Reiniciar servi√ßos
docker-compose -f docker-compose.prod.yml up -d
```

---

## üîí SSL/TLS

### Configura√ß√£o Inicial

```bash
# Configurar SSL com Let's Encrypt
sudo bash scripts/setup-ssl.sh -d bot.seudominio.com -e admin@seudominio.com

# Teste (ambiente staging)
sudo bash scripts/setup-ssl.sh -d bot.seudominio.com -e admin@seudominio.com --staging
```

### Renova√ß√£o Autom√°tica

Os certificados s√£o renovados automaticamente via cron job:

```bash
# Verificar agendamento
crontab -l | grep ssl

# Testar renova√ß√£o
sudo bash scripts/renew-ssl.sh

# Verificar logs de renova√ß√£o
tail -f logs/ssl-renewal.log
```

### Verifica√ß√£o Manual

```bash
# Verificar certificado
openssl x509 -in nginx/ssl/fullchain.pem -text -noout

# Verificar expira√ß√£o
openssl x509 -in nginx/ssl/fullchain.pem -noout -enddate

# Testar conex√£o SSL
curl -I https://bot.seudominio.com
```

---

## üîß Manuten√ß√£o

### Rotinas Di√°rias

```bash
# Verificar status dos containers
docker-compose -f docker-compose.prod.yml ps

# Verificar logs de erro
docker-compose -f docker-compose.prod.yml logs --tail=50 hawk-bot

# Verificar uso de recursos
docker stats --no-stream

# Verificar espa√ßo em disco
df -h
```

### Rotinas Semanais

```bash
# Limpar containers parados
docker container prune -f

# Limpar imagens n√£o utilizadas
docker image prune -f

# Limpar volumes √≥rf√£os
docker volume prune -f

# Verificar logs de backup
tail -f /backups/backup.log

# Atualizar sistema
sudo apt update && sudo apt upgrade -y
```

### Rotinas Mensais

```bash
# Reiniciar todos os servi√ßos
docker-compose -f docker-compose.prod.yml restart

# Verificar integridade dos backups
for backup in /backups/hawk-bot-backup_*.tar.gz; do
    echo "Verificando: $backup"
    tar -tzf "$backup" > /dev/null && echo "OK" || echo "ERRO"
done

# Limpar logs antigos
find logs/ -name "*.log" -mtime +30 -delete

# Verificar atualiza√ß√µes de seguran√ßa
sudo unattended-upgrades --dry-run
```

---

## üîç Troubleshooting

### Bot N√£o Conecta ao Discord

```bash
# Verificar logs do bot
docker logs hawk-bot --tail=100

# Verificar token
echo $DISCORD_TOKEN | wc -c  # Deve ter ~70 caracteres

# Testar conectividade
curl -H "Authorization: Bot $DISCORD_TOKEN" https://discord.com/api/v10/gateway

# Reiniciar apenas o bot
docker-compose -f docker-compose.prod.yml restart hawk-bot
```

### Redis Connection Error

```bash
# Verificar status do Redis
docker logs hawk-redis --tail=50

# Testar conex√£o
docker exec hawk-redis redis-cli ping

# Verificar configura√ß√£o
docker exec hawk-redis redis-cli config get "*"

# Reiniciar Redis
docker-compose -f docker-compose.prod.yml restart hawk-redis
```

### Alto Uso de CPU/Mem√≥ria

```bash
# Identificar processo problem√°tico
docker stats --no-stream

# Verificar logs de erro
docker-compose -f docker-compose.prod.yml logs --tail=100

# Reiniciar container espec√≠fico
docker-compose -f docker-compose.prod.yml restart CONTAINER_NAME

# Verificar recursos do sistema
htop
free -h
df -h
```

### SSL Certificate Issues

```bash
# Verificar certificado
openssl x509 -in nginx/ssl/fullchain.pem -text -noout

# Testar renova√ß√£o
sudo certbot renew --dry-run

# Recriar certificado
sudo bash scripts/setup-ssl.sh -d bot.seudominio.com -e admin@seudominio.com --force

# Verificar configura√ß√£o do Nginx
nginx -t
```

### Grafana/Prometheus Issues

```bash
# Verificar Prometheus targets
curl http://localhost:9090/api/v1/targets

# Reiniciar Grafana
docker-compose -f docker-compose.prod.yml restart hawk-grafana

# Verificar datasources do Grafana
curl -u admin:$GRAFANA_ADMIN_PASSWORD http://localhost:3000/api/datasources

# Recriar dashboards
docker-compose -f docker-compose.prod.yml restart hawk-grafana
```

---

## üíª Comandos √öteis

### Docker

```bash
# Ver todos os containers
docker ps -a

# Logs de um container espec√≠fico
docker logs -f hawk-bot

# Executar comando em container
docker exec -it hawk-bot bash

# Verificar uso de recursos
docker stats

# Limpar sistema Docker
docker system prune -a
```

### Docker Compose

```bash
# Iniciar servi√ßos
docker-compose -f docker-compose.prod.yml up -d

# Parar servi√ßos
docker-compose -f docker-compose.prod.yml down

# Reiniciar servi√ßo espec√≠fico
docker-compose -f docker-compose.prod.yml restart hawk-bot

# Ver logs de todos os servi√ßos
docker-compose -f docker-compose.prod.yml logs -f

# Atualizar e reiniciar
docker-compose -f docker-compose.prod.yml pull
docker-compose -f docker-compose.prod.yml up -d
```

### Sistema

```bash
# Verificar portas em uso
sudo netstat -tlnp | grep :80
sudo netstat -tlnp | grep :443

# Verificar processos
ps aux | grep docker

# Verificar espa√ßo em disco
du -sh /var/lib/docker
du -sh /backups

# Verificar logs do sistema
journalctl -u docker.service -f
```

---

## üìù Logs

### Localiza√ß√£o dos Logs

```
logs/
‚îú‚îÄ‚îÄ app.log              # Logs da aplica√ß√£o
‚îú‚îÄ‚îÄ error.log            # Logs de erro
‚îú‚îÄ‚îÄ access.log           # Logs de acesso
‚îú‚îÄ‚îÄ backup.log           # Logs de backup
‚îú‚îÄ‚îÄ ssl-renewal.log      # Logs de renova√ß√£o SSL
‚îî‚îÄ‚îÄ deploy.log           # Logs de deploy
```

### Comandos de Log

```bash
# Logs em tempo real
tail -f logs/app.log

# Logs com filtro
grep "ERROR" logs/app.log

# Logs por data
grep "2024-01-15" logs/app.log

# Logs de containers
docker-compose -f docker-compose.prod.yml logs -f hawk-bot

# Logs do sistema
journalctl -u docker.service --since "1 hour ago"
```

### Rota√ß√£o de Logs

Os logs s√£o automaticamente rotacionados pelo Docker. Para configurar manualmente:

```bash
# Configurar logrotate
sudo nano /etc/logrotate.d/hawk-bot

# Conte√∫do:
/path/to/logs/*.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 644 root root
}
```

---

## üÜò Suporte

### Contatos

- **Email**: admin@seudominio.com
- **Discord**: Servidor de suporte
- **GitHub**: Issues no reposit√≥rio

### Informa√ß√µes para Suporte

Ao solicitar suporte, inclua:

```bash
# Informa√ß√µes do sistema
uname -a
docker --version
docker-compose --version

# Status dos containers
docker-compose -f docker-compose.prod.yml ps

# Logs recentes
docker-compose -f docker-compose.prod.yml logs --tail=100

# Uso de recursos
docker stats --no-stream
free -h
df -h
```

---

## üìö Recursos Adicionais

- [Documenta√ß√£o do Discord.js](https://discord.js.org/)
- [Docker Documentation](https://docs.docker.com/)
- [Prometheus Documentation](https://prometheus.io/docs/)
- [Grafana Documentation](https://grafana.com/docs/)
- [Let's Encrypt Documentation](https://letsencrypt.org/docs/)

---

**√öltima atualiza√ß√£o**: $(date '+%Y-%m-%d')
**Vers√£o do guia**: 1.0.0

> ü¶Ö **Hawk Bot Esports** - Elevando sua comunidade de esports ao pr√≥ximo n√≠vel!